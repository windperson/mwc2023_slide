---
title: Blazorå¯«ä¸€æ¬¡å°±è¨å¥½ &nbsp;<br/>&nbsp; Web ï¼† App é–‹ç™¼

author: è€é®‘ä¼¯
format:
    # pptx:
    #    reference-doc: ../templates/template.pptx
    revealjs:
        width: 1700
        height: 1050
        margin: 0.2
        slide-tone: false
        theme: simple
        menu:
            side: right
        include-in-header: 
            text: |
                <style>
                .center-xy {
                margin: 0;
                position: absolute;
                top: 50%;
                left: 50%;
                -ms-transform: translateY(-50%), translateX(-50%);
                transform: translateY(-50%), translateX(-50%);
                }
                </style>
---


## Agenda

::: {.r-stretch}

![](URL.svg)

::: 

* Blazor Introduction
* WebRTC demo project

Slides made by [**Quarto**](https://quarto.org){target="_blank"} & GitHub Action: 

[https://github.com/windperson/mwc2023_slide](https://github.com/windperson/mwc2023_slide){target="_blank"}

# Blazor Introduction

## What is (ASP.NET Core) Blazor

**Singla Page Application(SPA)** frammework for building interactive client-side web UI using .NET Core/5+ C# without "*too much*" client-side JavaScript.

:::: {.columns}

::: {.column width="70%"}

* Component-based architecture
* Different [hosting models](https://learn.microsoft.com/aspnet/core/blazor/hosting-models){target="_blank"}:
    * Blazor WebAssembly (Blazor WASM)
        * Blazor PWA (Progressive Web App)
        * **Blazor Hybrid**
    * Blazor Server
    * United in .NET 8 : *static server rendering*, *streaming rendering*, *interactive rendering(prerender)*

:::

::: {.column width="30%"}

![[https://wikipedia.org/wiki/Blazor](https://wikipedia.org/wiki/Blazor){target="_blank"}](./pics/Blazor.png)

:::

::::

## Razor components 

A self-contained chunk of user interface (UI), such as a page, dialog, or form.

Includes HTML markup and the processing logic required to inject data or respond to UI events.

- using **`.razor`** file extension:
   - (Optional) routing tag helpers (`@page`) or `@layout` directive
   - `@using` , `@implements`, `@inherits`, `@inject` for C# lang syntax and DI 
   - Razor syntax code to present HTML & Razor components (may mixed C# code)
   - `@code` block for C# code


## Razor components example {.scrollable}

```{.razor code-line-numbers="|1-3|5-38|40-47"}
@page "/fetchdata"
@using BlazorWasmAppDemo.Shared
@inject HttpClient Http

<PageTitle>Weather forecast</PageTitle>

<h1>Weather forecast</h1>

<p>This component demonstrates fetching data from the server.</p>

@if (forecasts == null)
{
    <p><em>Loading...</em></p>
}
else
{
    <table class="table">
        <thead>
            <tr>
                <th>Date</th>
                <th>Temp. (C)</th>
                <th>Temp. (F)</th>
                <th>Summary</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var forecast in forecasts)
            {
                <tr>
                    <td>@forecast.Date.ToShortDateString()</td>
                    <td>@forecast.TemperatureC</td>
                    <td>@forecast.TemperatureF</td>
                    <td>@forecast.Summary</td>
                </tr>
            }
        </tbody>
    </table>
}

@code {
    private WeatherForecast[]? forecasts;

    protected override async Task OnInitializedAsync()
    {
        forecasts = await Http.GetFromJsonAsync<WeatherForecast[]>("WeatherForecast");
    }
}
```

---

:::{.callout-tip}

* Component can consist other child components, and control via *"Parameters"*
* Component can be nested, reused, shared among projects
* A component can be made very easily then other traditional UI frameworks

:::

## CSS isolation for components {.scrollable}

A "scoped" CSS file ( **.razor.css** ) can be added to a component to provide isolated CSS only for it.

Support [CSS Variables](https://developer.mozilla.org/en-US/docs/Web/CSS/Using_CSS_custom_properties){target="_blank"}, so we can programmatically change CSS style in C# code.

:::: {.columns}

::: {.column width="50%"}

**Button.razor.css**
```{.css}
button {
    width: var(--btn-width);
    height: var(--btn-height);
    font-size: var(--btn-fontSize);
    color: var(--btn-foreground);
    background-color: var(--btn-background);
}
```
:::

::: {.column width="50%"}

**Button.razor**
```{.razor}
<button style="--btn-width:@CssAttributes.Width;
               --btn-height:@CssAttributes.Height;
               --btn-fontSize:@CssAttributes.FontSize;
               --btn-foreground:@CssAttributes.ForegroundColor;
               --btn-background:@CssAttributes.BackgroundColor;"
        @onclick="MouseClick">
    @Content
</button>

@code {
    [Parameter]
    public ButtonStyle CssAttributes { get; set; } = null!;

    /* other code */
}
```
:::

::::

[DemoBlazorDynamicCss](https://github.com/windperson/DemoBlazorDynamicCss){target="_blank"} example project

## Data binding

* One-way data binding
* Two-way data binding
* Event binding

## Event binding example {.scrollable}

```{.razor code-line-numbers="9,14-17"}
@page "/counter"

<PageTitle>Counter</PageTitle>

<h1>Counter</h1>

<p role="status">Current count: @currentCount</p>

<button class="btn btn-primary" @onclick="IncrementCount">Click me</button>

@code {
    private int currentCount = 0;

    private void IncrementCount()
    {
        currentCount++;
    }
}
```

## Routing and Layouts

* For Browser's Url routing, using `@page` directive
* [Kebab-case](https://developer.mozilla.org/docs/Glossary/Kebab_case){target="_blank"} naming convention
* Provide a mechanism to show common error page when routing to a non-existing page

```{.razor code-line-numbers="6-11"}
<Router AppAssembly="@typeof(App).Assembly">
    <Found Context="routeData">
        <RouteView RouteData="@routeData" DefaultLayout="@typeof(MainLayout)" />
        <FocusOnNavigate RouteData="@routeData" Selector="h1" />
    </Found>
    <NotFound>
        <PageTitle>Not found</PageTitle>
        <LayoutView Layout="@typeof(MainLayout)">
            <p role="alert">Sorry, there's nothing at this address.</p>
        </LayoutView>
    </NotFound>
</Router>
```

## Dependency injection

* Use the `@inject` directive to inject services into components.
* Co-operate with the .NET Core DI container.

```{.cs code-line-numbers="5-8"}
var builder = WebAssemblyHostBuilder.CreateDefault(args);

/* other builder config code*/

builder.Services.AddScoped(sp => 
    new HttpClient { BaseAddress = new Uri(builder.HostEnvironment.BaseAddress) });
builder.Services.AddScoped<IPlatformInfo, PlatformInfo>();
builder.Services.AddScoped<BrowserService>();

await builder.Build().RunAsync();
```

## JavaScript interop

* [Call JavaScript function from .NET method](https://learn.microsoft.com/aspnet/core/blazor/javascript-interoperability/call-javascript-from-dotnet){target="_blank"}
* [Call .NET method from JavaScript function](https://learn.microsoft.com/aspnet/core/blazor/javascript-interoperability/call-dotnet-from-javascript){target="_blank"}
* Using `[JSImport]` / `[JSExport]` attribute in Blazor WASM(.NET 7+)


We can use Js Interop to co-operate something that Blazor doesn't support yet, such as [WebRTC](https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API){target="_blank"} or [WebGL](https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API){target="_blank"}.


![[Three.js interop demo](https://github.com/windperson/MauiBlazorThreeJsDemo){target="_blank"}](./pics/android_screen_shot.png)


## Blazor Hybrid on .NET MAUI {.scrollable}

:::: {.columns}

::: {.column width="50%"}
* The Blazor Hybrid can run on [.NET MAUI(Multi-platform App UI)](https://dotnet.microsoft.com/apps/maui){target="_blank"} / [WPF](https://github.com/dotnet/wpf){target="_blank"} / [Winform](https://github.com/dotnet/winforms){target="_blank"} Native apps.
* We can use the same Blazor source code to build Web and App.(Reusable UI)
:::

::: {.column width="50%"}
![*VS 2022 project template*](./pics/BlazorMauiProjectTemplate.png)
:::

::::

---

:::: {.columns}

::: {.column width="50%"}
The Power of Blazor Hybrid on .NET MAUI is that we can call .NET MAUI API from Blazor `@code` block.
:::

::: {.column width="50%"}
![](./pics/Blazor_Hybrid_OnMAUI.png){.r-stretch}
:::

::::

## Reuse UI for Web & App via RCL 

:::: {.columns}

::: {.column width="50%"}

By using [Razor Class Library(RCL)](https://learn.microsoft.com/aspnet/core/razor-pages/ui-class){target="_blank"} to share UI components between Web and App.

::: 

::: {.column width="50%"}

![](./pics/Using_RCL_share_UI.png)

:::

::::

## Project setup {.scrollable}

1. å»ºç«‹ MAUI (with Hybrid Blazor) å°ˆæ¡ˆ
2. å»ºç«‹ RCL(Razor Class Library) å°ˆæ¡ˆï¼Œä¸¦å°‡å…¶åŠ å…¥ MAUI å°ˆæ¡ˆçš„[å°ˆæ¡ˆåƒè€ƒ (Project Reference)](https://learn.microsoft.com/visualstudio/ide/managing-references-in-a-project?view=vs-2022){target="_blank"}
3. å°‡ MAUI å°ˆæ¡ˆä¸­ Blazor ç›¸é—œç›®éŒ„&æª”æ¡ˆæ¬ç§»åˆ° RCL å°ˆæ¡ˆä¸­
4. ä¿®æ”¹é‚„ç•™åœ¨ MAUI å°ˆæ¡ˆä¸­çš„å¿…è¦ Blazor æ‰€éœ€æª”æ¡ˆå…§å®¹ï¼ŒåŒ…æ‹¬ç¶²é éœæ…‹è³‡æºå¼•ç”¨è·¯å¾‘ã€Blazor è·¯ç”±å…ƒä»¶å¢åŠ  [`AdditionalAssemblies`](https://learn.microsoft.com/dotnet/api/microsoft.aspnetcore.components.routing.router.additionalassemblies){target="_blank"} å±¬æ€§ä¸¦æŒ‡å®šè‡³æ¬ç§»åˆ° RCL å°ˆæ¡ˆçš„ MainLayout å…ƒä»¶
5. å•Ÿå‹• MAUI å°ˆæ¡ˆé©—è­‰åŠŸèƒ½æ˜¯å¦æ­£å¸¸
6. ç”¨ Visual Studio 2022 å°ˆæ¡ˆç²¾éˆå»ºç«‹ Blazor WASM å°ˆæ¡ˆåŠæ­é…çš„ asp.net core æ¸¬è©¦å¾Œç«¯å°ˆæ¡ˆ
7. å°‡ RCL å°ˆæ¡ˆåŠ å…¥åˆ° Blazor WASM å°ˆæ¡ˆçš„å°ˆæ¡ˆåƒè€ƒ (Project Reference)
8. æ¬ç§» Blazor WASM å°ˆæ¡ˆèˆ‡ Razor é é¢ç›¸é—œä¹‹ç›®éŒ„ï¼†æª”æ¡ˆï¼Œèˆ‡ RCL å°ˆæ¡ˆä¸­æ—¢æœ‰çš„åˆä½µæˆ–èª¿æ•´
9. ä¿®æ”¹é‚„ç•™åœ¨ Blazor WASM å°ˆæ¡ˆçµ„åˆä¸­çš„å¿…è¦ Blazor æ‰€éœ€æª”æ¡ˆå…§å®¹ï¼ŒåŒ…æ‹¬ç¶²é éœæ…‹è³‡æºå¼•ç”¨è·¯å¾‘ã€Blazor è·¯ç”±å…ƒä»¶å¢åŠ  `AdditionalAssemblies` å±¬æ€§è¨­å®šï¼Œä»¥åŠé…å¥— asp.net core å¾Œç«¯å°ˆæ¡ˆç§»é™¤æ‰ä¸ä½¿ç”¨çš„ API Controllerï¼Œ `Program.cs` ä¿®æ”¹ç‚ºæ­£ç¢ºçš„ DI æœå‹™è¨­å®š
10. å€‹åˆ¥å•Ÿå‹• Blazor WASMã€MAUI å°ˆæ¡ˆï¼Œé©—è­‰åŠŸèƒ½å‡å¯æ­£å¸¸é‹ä½œ

## Project setup - continued {.scrollable}

- æ­¥é©Ÿ 6 åœ¨å°ˆæ¡ˆç²¾éˆè¨˜å¾—ä¸è¦é¸åˆ°ç©ºç™½å°ˆæ¡ˆï¼Œä¸¦ä¸”æœ€å¾Œä¸€æ­¥è¦æŒ‡å®šä½¿ç”¨ .NET 7ï¼Œé‚„æœ‰å‹¾é¸ã€ASP.NET Coreè¨—ç®¡ (ASP.NET Core Hosted) ã€ä»¥ä¾¿ç”¢ç”Ÿå®Œæ•´å«åŸ·è¡Œ WASM ä¹‹ç”¨çš„ ASP.NET Core å¾Œç«¯å°ˆæ¡ˆçµ„åˆ 
    - é€™éº¼åšçš„ç›®çš„æ˜¯ï¼Œ.NET 7 çš„ Blazor WASM å®Œæ•´å°ˆæ¡ˆç¯„æœ¬ç”¢å‡ºä¾†é è¨­æœ‰ã€è¼‰å…¥é€²åº¦æ¢ã€çš„æ–°åŠŸèƒ½ï¼Œæ­¤åŠŸèƒ½æ‰€éœ€ä¹‹ CSS è¨­å®šï¼Œå¾—åˆä½µåˆ° RCL å°ˆæ¡ˆåŸæœ¬å¾ MAUI å°ˆæ¡ˆæ¬éä¾†çš„ app.css ä¹‹ä¸­
- æ­¥é©Ÿ 8 ç´°éƒ¨å‹•ä½œï¼š
    1. ç”±å°ˆæ¡ˆç²¾éˆæ–°å»ºç«‹çš„ Blazor WASM Client å°ˆæ¡ˆä¸­çš„ *Pages*ã€*Shared* ç›®éŒ„éƒ½åˆªé™¤
    2. å°‡å¦ä¸€å€‹ç”¨ä¾†åœ¨ Blazor WASM å°ˆæ¡ˆçµ„åˆä¸­å‰å¾Œç«¯å…±ç”¨çš„ Data Model (åç¨±æœ«å°¾ç‚º `.Shared`)é¡åˆ¥åº«(Class Library)å°ˆæ¡ˆä¹Ÿåˆªé™¤ 
    3. Blazor WASM Client å°ˆæ¡ˆä¸­ **wwwroot/css** ç›®éŒ„å…§é™¤äº† **app.css** ä¹‹å¤–çš„æª”æ¡ˆè¤‡è£½åˆ° RCL å°ˆæ¡ˆä¸­çš„ **wwwroot/css** ç›®éŒ„å…§
    4. Blazor WASM Client å°ˆæ¡ˆä¸­ **wwwroot/css/app.css** æª”æ¡ˆçš„éƒ¨åˆ†å…§å®¹æŠ„å¯«åˆ° RCL å°ˆæ¡ˆä¸­ **wwwroot/css/app.css** æª”æ¡ˆå…§

app.css 21~23 è¡Œ
```{.css}
.btn:focus, .btn:active:focus, .btn-link.nav-link:focus, .form-control:focus, .form-check-input:focus {
  box-shadow: 0 0 0 0.1rem white, 0 0 0 0.25rem #258cfb;
}
```

app.css 70~101 è¡Œ
```{.css}
.loading-progress {
    position: relative;
    display: block;
    width: 8rem;
    height: 8rem;
    margin: 20vh auto 1rem auto;
}

    .loading-progress circle {
        fill: none;
        stroke: #e0e0e0;
        stroke-width: 0.6rem;
        transform-origin: 50% 50%;
        transform: rotate(-90deg);
    }

        .loading-progress circle:last-child {
            stroke: #1b6ec2;
            stroke-dasharray: calc(3.141 * var(--blazor-load-percentage, 0%) * 0.8), 500%;
            transition: stroke-dasharray 0.05s ease-in-out;
        }

.loading-progress-text {
    position: absolute;
    text-align: center;
    font-weight: bold;
    inset: calc(20vh + 3.25rem) 0 auto 0.2rem;
}

    .loading-progress-text:after {
        content: var(--blazor-load-percentage-text, "Loading");
    }
```

## 

åœ¨ App, Web éƒ½å…±ç”¨ RCL å°ˆæ¡ˆè£¡å®šç¾©çš„ Razor UI é é¢å…ƒä»¶ï¼Œ*å¯«ä¸€æ¬¡å°±åŒæ™‚è¨å¥½ Web & App UI é–‹ç™¼*ã€‚ 

![](./pics/Demo_Shared_RCL_UI.png)


:::{ style="text-align: center;font-size:0.7em;"}

[åŸå§‹ç¢¼GitHub](https://github.com/windperson/MWC2023WebRtcDemo/tree/UI_shared){target="_blank"}

:::

# WebRTC demo project

## {.r-stretch}

![](./pics/Blazor_WebRTC_demo.png)


## Project structure

source: <https://github.com/windperson/MWC2023WebRtcDemo>

Try to follow the [BlazorRtc](https://github.com/ParrhesiaJoe/BlazorRtc){target="_blank"} a Blazor WASM WebRTC demo project, but apply on Blazor Hybrid.

* Use routing to switch to different Razor components without dependency
* Layout Icon is from [OpenIconic](https://www.appstudio.dev/app/OpenIconic.html){target="_blank"} , not Bootstrap Icons.
* You will got lot of trouble when trying to use some bizarre Js API or need to get around permission problems on MAUI side.

## WebRTC

* The WebRTC API is accessed via Js Interop

* The js code is messy, GitHub Copilot Chat is merrily to help you ğŸ§‘â€ğŸ’»

![](./pics/Ask_copilot_for_answer.png){r-stretch}

## Conclusion &nbsp;<br/>&nbsp; Q & A

## Reference

* [ASP.NET Core Blazor](https://dotnet.microsoft.com/apps/aspnet/web-apps/blazor)
* [Blazor Essentials](https://www.jetbrains.com/guide/dotnet/tutorials/blazor-essentials/)
* [Introduction to WebRTC protocols](https://developer.mozilla.org/en-US/docs/Web/API/WebRTC_API/Protocols)
* [Udemy - AspNetCore Blazor:The Big Picture](https://www.udemy.com/course/aspnet-core-blazor-the-big-picture/)
* [MS Learn - Build web applications with Blazor](https://learn.microsoft.com/en-us/training/paths/build-web-apps-with-blazor/)
* [(StackOverflow) Blazor MAUI - Camera and Microphone Android permissions](https://stackoverflow.com/a/75591585/1075882)